<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>


<sqlMap namespace="roomSQL">
	<typeAlias alias="room" type="bean.RoomBean" />
	<typeAlias alias="roomReservation" type="bean.RoomReservationBean" />
	
	<resultMap id="roomRes" class="room">
		<result property="no" column="no" />
		<result property="name" column="name" />
		<result property="room_size" column="room_size" />
		<result property="room_capacity" column="room_capacity" />
		<result property="construction" column="construction" />
		<result property="room_comment" column="room_comment" />
		<result property="orgImage" column="orgImage" />
		<result property="savImage" column="savImage" />
		<result property="price" column="price" />
		<result property="room_class" column="room_class" />
	</resultMap>
	
	
	<sql id="select-all">SELECT * FROM ROOM</sql>
	
	<sql id="where-no">WHERE NO = #no#</sql>
	
	<select id="selectAll" resultMap="roomRes">
		<include refid="select-all"/>
		ORDER BY no DESC
	</select>
	
	<select id="selectSerch" resultMap="roomRes" parameterClass="roomReservation" >
		SELECT * FROM ROOM WHERE NO NOT IN   
		  (SELECT DISTINCT NO FROM ROOM_RESERVATION  
		   WHERE 
		    FIRSTDATE between #firstDate# and #lastDate# or 
		    LASTDATE between #firstDate# and #lastDate#
		  ) AND ROOM_CAPACITY >= #people#
		  ORDER BY NO DESC
	</select>
	
	<select id="selectSerchGroup" resultMap="roomRes" parameterClass="roomReservation">
		SELECT * FROM ROOM WHERE NO NOT IN   
		  (SELECT DISTINCT NO FROM ROOM_RESERVATION  
		   WHERE 
		    FIRSTDATE between #firstDate# and #lastDate# or 
		    LASTDATE between #firstDate# and #lastDate#
		  ) AND ROOM_CAPACITY = #people#
		  ORDER BY NO DESC
	</select>
	
	<select id="selectOne" resultMap="roomRes">
		<include refid="select-all"/>
		<include refid="where-no"/>
	</select>
	
	<insert id="insertRoom" parameterClass="room">
		INSERT INTO ROOM(NO, NAME, ROOM_SIZE, ROOM_CAPACITY, CONSTRUCTION, ROOM_COMMENT,
		ORGIMAGE, SAVIMAGE, PRICE, ROOM_CLASS) VALUES (#no#, #name#, #room_size#,
		#room_capacity#, #construction#, #room_comment#, #orgImage#, #savImage#,
		#price#, #room_class#)
	</insert>
	
	<update id="updateRoom" parameterClass="room">
		UPDATE ROOM SET NAME = #name#, ROOM_SIZE = #room_size#, ROOM_CAPACITY = #room_capacity#,
		CONSTRUCTION = #construction#, ROOM_COMMENT = #room_comment#,
		ORGIMAGE = #orgImage#, SAVIMAGE = #savImage#, PRICE = #price#, ROOM_CLASS = #room_class# 
		<include refid="where-no"/>
	</update>
	
	<update id="updateImage" parameterClass="room"> 
		UPDATE ROOM SET ORGIMAGE = #orgImage#, SAVIMAGE = #savImage#
		<include refid="where-no"/>
	</update>
	
	<delete id="deleteRoom" parameterClass="room">
		DELETE FROM ROOM
		<include refid="where-no"/>
	</delete>
</sqlMap>